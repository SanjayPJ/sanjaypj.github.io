<!doctype html><html lang=en-us class="scroll-smooth dark"><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Understanding Virtual DOM: A Simple Implementation Guide</title><meta name=description content="An in-depth look at the Virtual DOM concept, exploring its benefits and providing a simple implementation guide in JavaScript. Learn how the Virtual DOM enhances performance in modern web applications."><link rel=canonical href=https://sanjaypj.github.io/posts/understanding-virtual-dom/><link rel=robots href=/robots.txt><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type=text/x-mathjax-config>
  MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });
</script><link rel=stylesheet href="https://sanjaypj.github.io/css/app.min.adb58da7f13c5160615206004b70d4281ed9b255f28892c1dc5d707d7b5f3c90.css" integrity="sha256-rbWNp/E8UWBhUgYAS3DUKB7ZslXyiJLB3F1wfXtfPJA="><link rel=preconnect href=https://fonts.googleapis.com><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap" rel=stylesheet><link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=Libre+Franklin:ital,wght@0,100..900;1,100..900&display=swap" rel=stylesheet></head><body class="max-w-screen-md mx-auto" style=padding-left:20px;padding-right:20px><div class=header><header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12" style=width:100%;padding-bottom:4rem><div class="flex-none w-20 h-20 rounded-full overflow-hidden"><a href=https://sanjaypj.github.io/><img src=/img/profile-picture.jpg width=960 height=960 alt="Sanjay PJ"></a></div><div class="flex flex-col gap-5"><a href=https://sanjaypj.github.io/><h1 id=site-title>Sanjay PJ</h1></a><nav><ul style=margin:0><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Categories</a></li><li><a href=/tags>Tags</a></li></ul></nav></div></header><button class=toggle-theme aria-label="Toggle Theme" title="Toggle Theme" onclick=toggleTheme()>
<span class="theme-icon light"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75.0 11-7.5.0 3.75 3.75.0 017.5.0z"/></svg></span><span class="theme-icon dark"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718.0 0118 15.75c-5.385.0-9.75-4.365-9.75-9.75.0-1.33.266-2.597.748-3.752A9.753 9.753.0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753.0 009.002-5.998z"/></svg></span></button>
<script>document.addEventListener("DOMContentLoaded",function(){const e=localStorage.getItem("theme");setTheme(!e||e==="light"?"light":e)});function setTheme(e){const t=document.querySelector("html");localStorage.setItem("theme",e),e==="light"?(t.classList.contains("dark")&&document.querySelector("html").classList.remove("dark"),document.querySelector(".theme-icon.light").style.display="none",document.querySelector(".theme-icon.dark").style.display="block"):(t.classList.contains("dark")||document.querySelector("html").classList.add("dark"),document.querySelector(".theme-icon.dark").style.display="none",document.querySelector(".theme-icon.light").style.display="block")}function toggleTheme(){const e=localStorage.getItem("theme");setTheme(e==="light"?"dark":"light")}</script></div><main id=content><article class="flex flex-col gap-10"><header class="flex flex-col gap-2"><h2 class="title-large serif">Understanding Virtual DOM: A Simple Implementation Guide</h2><div class=meta><time datetime="2024-10-29 19:58:37.794 +0000 UTC" title='Tue, Oct 29, 2024, 7:58 PM UTC'>29/10/2024 - Estimated reading time: 4 minutes</time>
—
<a class=categories href=/categories/web-development/ alt="Web Development">Web Development</a>
<a class=categories href=/categories/frontend/ alt=Frontend>Frontend</a></div></header><div id=toc style="border:1px solid #ebebeb;padding:20px;border-radius:15px"><h4 class=serif>>> Table of Contents</h4><div style=font-size:12px><nav id=TableOfContents><ul><li><a href=#what-is-virtual-dom>What is Virtual DOM?</a><ul><li><a href=#why-use-virtual-dom>Why Use Virtual DOM?</a></li></ul></li><li><a href=#building-a-simple-virtual-dom>Building a Simple Virtual DOM</a><ul><li><a href=#step-1-define-a-virtual-dom-structure>Step 1: Define a Virtual DOM Structure</a></li><li><a href=#step-2-rendering-the-virtual-dom>Step 2: Rendering the Virtual DOM</a></li><li><a href=#step-3-implementing-the-diffing-algorithm>Step 3: Implementing the Diffing Algorithm</a></li><li><a href=#step-4-patching-the-real-dom>Step 4: Patching the Real DOM</a></li><li><a href=#bringing-it-all-together>Bringing It All Together</a></li><li><a href=#conclusion>Conclusion</a></li></ul></li></ul></nav></div></div><section class=serif><p>In modern web development, efficient rendering is crucial for creating responsive applications. One of the most popular approaches to improving performance is the Virtual DOM. In this blog post, we’ll explore what the Virtual DOM is, why it’s beneficial, and how to implement a basic version in JavaScript.</p><h2 id=what-is-virtual-dom>What is Virtual DOM?</h2><p>The Virtual DOM is an abstraction of the actual DOM (Document Object Model) that allows web applications to update the UI efficiently. Instead of directly manipulating the real DOM, which can be slow and resource-intensive, we can manipulate a lightweight copy—the Virtual DOM. This approach enables quick calculations and minimal updates to the real DOM, resulting in better performance.</p><h3 id=why-use-virtual-dom>Why Use Virtual DOM?</h3><ol><li><strong>Performance:</strong> Updating the real DOM is costly. By using the Virtual DOM, we minimize direct manipulations, leading to faster rendering.</li><li><strong>Efficiency:</strong> The Virtual DOM uses a diffing algorithm to determine what has changed, allowing us to update only the parts of the DOM that need to change.</li><li><strong>Declarative Syntax:</strong> Using a Virtual DOM makes it easier to describe the UI state. You define what the UI should look like at any point in time, and the Virtual DOM takes care of the updates.</li></ol><h2 id=building-a-simple-virtual-dom>Building a Simple Virtual DOM</h2><p>Let’s dive into implementing a simple Virtual DOM from scratch. We’ll cover the following steps:</p><ol><li><strong>Creating the Virtual DOM representation.</strong></li><li><strong>Rendering the Virtual DOM to the Real DOM.</strong></li><li><strong>Implementing a diffing algorithm.</strong></li><li><strong>Patching the Real DOM with the computed differences.</strong></li></ol><h3 id=step-1-define-a-virtual-dom-structure>Step 1: Define a Virtual DOM Structure</h3><p>We start by creating a function to represent Virtual DOM nodes:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> h(type, props <span style=color:#ff79c6>=</span> {}, ...children) {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> { type, props, children };
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li><code>type</code>: The type of the element (e.g., <code>div</code>, <code>span</code>).</li><li><code>props</code>: An object representing attributes (e.g., <code>id</code>, <code>className</code>).</li><li><code>children</code>: The child elements of the node.</li></ul><h3 id=step-2-rendering-the-virtual-dom>Step 2: Rendering the Virtual DOM</h3><p>Next, we create a function to render a Virtual DOM node to a real DOM node:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> render(vNode) {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>typeof</span> vNode <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#34;string&#34;</span>) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#8be9fd;font-style:italic>document</span>.createTextNode(vNode);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> element <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.createElement(vNode.type);
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>for</span> (<span style=color:#ff79c6>const</span> [key, value] <span style=color:#ff79c6>of</span> <span style=color:#8be9fd;font-style:italic>Object</span>.entries(vNode.props)) {
</span></span><span style=display:flex><span>    element.setAttribute(key, value);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  vNode.children.map(render).forEach((child) =&gt; element.appendChild(child));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> element;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=step-3-implementing-the-diffing-algorithm>Step 3: Implementing the Diffing Algorithm</h3><p>Now, we need to compare the old Virtual DOM with the new one. This is done through a diffing function:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> diff(oldVNode, newVNode) {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>newVNode) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> { type<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;REMOVE&#34;</span> };
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>typeof</span> oldVNode <span style=color:#ff79c6>!==</span> <span style=color:#ff79c6>typeof</span> newVNode <span style=color:#ff79c6>||</span>
</span></span><span style=display:flex><span>    (<span style=color:#ff79c6>typeof</span> oldVNode <span style=color:#ff79c6>===</span> <span style=color:#f1fa8c>&#34;string&#34;</span> <span style=color:#ff79c6>&amp;&amp;</span> oldVNode <span style=color:#ff79c6>!==</span> newVNode) <span style=color:#ff79c6>||</span>
</span></span><span style=display:flex><span>    oldVNode.type <span style=color:#ff79c6>!==</span> newVNode.type
</span></span><span style=display:flex><span>  ) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> { type<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;REPLACE&#34;</span>, newVNode };
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (oldVNode.type) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> propChanges <span style=color:#ff79c6>=</span> [];
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> allProps <span style=color:#ff79c6>=</span> { ...oldVNode.props, ...newVNode.props };
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> (<span style=color:#ff79c6>const</span> key <span style=color:#ff79c6>in</span> allProps) {
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>if</span> (oldVNode.props[key] <span style=color:#ff79c6>!==</span> newVNode.props[key]) {
</span></span><span style=display:flex><span>        propChanges.push({ key, value<span style=color:#ff79c6>:</span> newVNode.props[key] });
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> childrenChanges <span style=color:#ff79c6>=</span> [];
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>const</span> maxLen <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>Math</span>.max(oldVNode.children.length, newVNode.children.length);
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> (<span style=color:#8be9fd;font-style:italic>let</span> i <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>; i <span style=color:#ff79c6>&lt;</span> maxLen; i<span style=color:#ff79c6>++</span>) {
</span></span><span style=display:flex><span>      childrenChanges.push(diff(oldVNode.children[i], newVNode.children[i]));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> { type<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;UPDATE&#34;</span>, propChanges, childrenChanges };
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=step-4-patching-the-real-dom>Step 4: Patching the Real DOM</h3><p>Finally, we apply the changes to the real DOM using the <code>patch</code> function:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>function</span> patch(parent, patches, index <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>0</span>) {
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>if</span> (<span style=color:#ff79c6>!</span>patches) <span style=color:#ff79c6>return</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> element <span style=color:#ff79c6>=</span> parent.childNodes[index];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>switch</span> (patches.type) {
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#34;REMOVE&#34;</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span>      parent.removeChild(element);
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#34;REPLACE&#34;</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span>      parent.replaceChild(render(patches.newVNode), element);
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>case</span> <span style=color:#f1fa8c>&#34;UPDATE&#34;</span><span style=color:#ff79c6>:</span>
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>for</span> (<span style=color:#ff79c6>const</span> { key, value } <span style=color:#ff79c6>of</span> patches.propChanges) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>if</span> (value <span style=color:#ff79c6>==</span> <span style=color:#ff79c6>null</span>) {
</span></span><span style=display:flex><span>          element.removeAttribute(key);
</span></span><span style=display:flex><span>        } <span style=color:#ff79c6>else</span> {
</span></span><span style=display:flex><span>          element.setAttribute(key, value);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      patches.childrenChanges.forEach((childPatch, i) =&gt; {
</span></span><span style=display:flex><span>        patch(element, childPatch, i);
</span></span><span style=display:flex><span>      });
</span></span><span style=display:flex><span>      <span style=color:#ff79c6>break</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=bringing-it-all-together>Bringing It All Together</h3><p>To see the Virtual DOM in action, we can create an initial Virtual DOM, render it, and then update it:</p><ol><li><p><strong>Create Initial Virtual DOM:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff79c6>const</span> vDom1 <span style=color:#ff79c6>=</span> h(
</span></span><span style=display:flex><span>  <span style=color:#f1fa8c>&#34;div&#34;</span>,
</span></span><span style=display:flex><span>  { id<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;container&#34;</span> },
</span></span><span style=display:flex><span>  h(<span style=color:#f1fa8c>&#34;h1&#34;</span>, {}, <span style=color:#f1fa8c>&#34;Hello World&#34;</span>),
</span></span><span style=display:flex><span>  h(<span style=color:#f1fa8c>&#34;p&#34;</span>, {}, <span style=color:#f1fa8c>&#34;This is a virtual DOM example.&#34;</span>)
</span></span><span style=display:flex><span>);
</span></span></code></pre></div></li><li><p><strong>Render It:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff79c6>const</span> root <span style=color:#ff79c6>=</span> <span style=color:#8be9fd;font-style:italic>document</span>.getElementById(<span style=color:#f1fa8c>&#34;app&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> realDom <span style=color:#ff79c6>=</span> render(vDom1);
</span></span><span style=display:flex><span>root.appendChild(realDom);
</span></span></code></pre></div></li><li><p><strong>Update the Virtual DOM and Patch:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#ff79c6>const</span> vDom2 <span style=color:#ff79c6>=</span> h(
</span></span><span style=display:flex><span>  <span style=color:#f1fa8c>&#34;div&#34;</span>,
</span></span><span style=display:flex><span>  { id<span style=color:#ff79c6>:</span> <span style=color:#f1fa8c>&#34;container&#34;</span> },
</span></span><span style=display:flex><span>  h(<span style=color:#f1fa8c>&#34;h1&#34;</span>, {}, <span style=color:#f1fa8c>&#34;Hello Virtual DOM!&#34;</span>),
</span></span><span style=display:flex><span>  h(<span style=color:#f1fa8c>&#34;p&#34;</span>, {}, <span style=color:#f1fa8c>&#34;This example demonstrates updating the DOM efficiently.&#34;</span>)
</span></span><span style=display:flex><span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>const</span> patches <span style=color:#ff79c6>=</span> diff(vDom1, vDom2);
</span></span><span style=display:flex><span>patch(root, patches);
</span></span></code></pre></div></li></ol><h3 id=conclusion>Conclusion</h3><p>By implementing a simple Virtual DOM, we gain a better understanding of how libraries like React optimize UI updates. The Virtual DOM helps manage changes in a performant manner, allowing developers to build rich and interactive applications without sacrificing speed.</p><p>Feel free to modify and experiment with this implementation to explore the power of the Virtual DOM!</p></section><footer><div class="pb-14 taxonomy-list tags-list"><a href=/tags/virtual-dom/ alt="Virtual DOM">Virtual DOM</a>
<a href=/tags/javascript/ alt=JavaScript>JavaScript</a>
<a href=/tags/react/ alt=React>React</a>
<a href=/tags/performance/ alt=Performance>Performance</a></div></footer></article></main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2"><div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">© 2024 —
<a href=https://sanjaypj.github.io/>Sanjay PJ</a></div><div class="order-1 sm:order-2"><ul class="flex sm:justify-end gap-5"><li><a href=https://x.com/iamsanjaypj target=_blank rel="noopener noreferrer">Twitter / X</a></li><li><a href=https://github.com/ghnew target=_blank rel="noopener noreferrer">GitHub</a></li></ul></div></footer></body></html>